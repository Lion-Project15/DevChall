<html layout:decorate="~{usr/member/layout.html}" xmlns="http://www.w3.org/1999/html">

<html>
<head>
    <meta charset="UTF-8">
    <title>챌린지 디테일 페이지</title>
</head>

<body class="bg-gray-100">
<main layout:fragment="main" class="flex flex-col w-full justify-center">
    <script>

        function wantJoin(challengeId) {
            if (confirm('해당 챌린지에 참여하시겠습니까?')) {
                alert("환영합니다! 챌린지에 열심히 참여해보세요!");
                location.href = "/usr/challenge/join/" + challengeId;
            } else {
                alert("참여가 취소되었습니다.");
            }
        }

    </script>


    <div class="flex w-full mt-10 mx-100 justify-center">
        <div class="mx-2 mt-9">
            <img th:src="${@photoService.getLargePhoto(challenge.challengePhoto)}" alt="challenge_image" class="w-[85%] h-auto"/>
        </div>
            <div class="w-1/3">
                <div class="flex justify-between">
                    <h3 class="text-2xl font-bold my-9" th:text="${challenge.challengeName}"></h3>
                    <!--                <p class="text-[30px] bolder-double font-bold mx-3" th:text="${challenge.challengeName}"></p>-->

                    <th:block th:unless="${byChallengeAndMember.isPresent()}">
                        <button th:onclick="'wantJoin(\'' + ${challenge.id} + '\')'"
                                th:style="'background-color: #' + ${@rq.member.equippedFont.item.pattern} +'; color: #' + ${@rq.member.equippedFont.item.subPattern}"
                                class="btn btn-accent mx-1 border-none mt-9" style="background-color: #03FA6E;">참여하기
                        </button>
                    </th:block>

                    <th:block th:if="${byChallengeAndMember.isPresent()}">
                        <a th:href="@{|/usr/challenge/write_form/${challenge.id}|}"
                           th:style="'background-color: #' + ${@rq.member.equippedFont.item.pattern} +'; color: #' + ${@rq.member.equippedFont.item.subPattern}"
                           class="btn btn-accent mx-1 border-none mt-9" style="background-color: #03FA6E;">
                            <button>인증하기</button>
                        </a>
                    </th:block>


                </div>
                <div class="card bg-white mt-3 h-75 flex place-content-around">

                    <div class="flex justify-around">
                        <div class="w-30 content-center items-center">
                            <h2 class="text-[17px] font-medium mt-5">챌린지 일정</h2>
                            <h2 class="text-[17px] font-medium mt-3">챌린지 인원</h2>
                            <h2 class="text-[17px] font-medium mt-3">주간 인증 횟수</h2>
                            <h2 class="text-[17px] font-medium mt-3">챌린지 개설자</h2>
                            <h2 class="text-[17px] font-medium mt-3">챌린지 태그</h2>
                            <h2 class="text-[17px] font-medium mt-3 mb-5">총 인증 게시물 수</h2>
                        </div>

                        <div class="w-70 content-center items-center">
                            <p class="text-[17px] bolder-double mt-5"
                               th:text="${challenge.startDate} + ' ~ ' + ${challenge.endDate}"></p>
                            <div class="badge badge-lg badge-outline gap-3 mt-3">
                                <i class="fa-solid fa-person fa-lg" style="color: #000000;"></i>
                                <p class="text-black" th:text="${@challengeMemberService.getChallengeUserCount(challenge)} + ' 명'"></p>
                            </div>
                            <p class="text-[17px] bolder-double mt-3"
                               th:text="'주 ' + ${challenge.challengeFrequency} + '회'"></p>
                            <p class="text-[17px] bolder-double mt-3" th:text="${challenge.challengeCreator}"></p>

                            <div class="mt-3">
                                <p class="badge badge-warning text-[17px] bolder-double badge-lg"
                                   th:text="${challenge.challengeTag.challengeLanguage}"></p>
                                <p class="badge badge-primary text-[17px] bolder-double badge-lg"
                                   th:text="${challenge.challengeTag.challengeSubject}"></p>
                                <p class="badge badge-notice text-[17px] bolder-double badge-lg"
                                   th:text="${challenge.challengeTag.challengePostType}"></p>
                            </div>

                            <th:block th:if="${#lists.isEmpty(challengePosts)}">
                                <p class="text-[17px] bolder-double mt-3"> 0 개</p>
                            </th:block>
                            <th:block th:unless="${#lists.isEmpty(challengePosts)}">
                                <p class="text-[17px] bolder-double mt-3 mb-5" th:text="${#lists.size(challengePosts)} + '개'"></p>
                            </th:block>

                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div>
            <div class="flex flex-wrap justify-center h-3/4 mt-14">
                <div class="w-1/8 h-full"></div>
                <div class="card bg-white w-5/6 h-full">
                    <div class="flex flex-col h-full">
                        <h1 class="text-[20px] font-black mt-5 mx-8">Challenge Introduction</h1>
                        <p class="text-[15px] font-double mt-5 mb-5 mx-14" th:text="${challenge.challengeContents}"></p>
                    </div>
                </div>
                <div class="w-1/8 h-full"></div>
            </div>

            <br/>

            <div class="flex flex-wrap justify-center mt-14">
                <div class="w-1/8 h-full"></div>
                <div class="card bg-white w-5/6 h-full">
                    <div class="flex flex-col items-center h-1/2">
                        <th:block th:if="${#lists.isEmpty(challengePosts)}">
                            <h2 class="text-[20px] font-black mt-5 mx-8">아직 아무도 인증하지 않았어요!</h2>
                        </th:block>

                        <div class="grid grid-cols-1 md:grid-cols-3 xl:grid-cols-5 gap-[5px] bg-white-500 my-10">
                            <th:block th:unless="${#lists.isEmpty(challengePosts)}">
                                <!-- 인증글 내용 -->

                                <div th:each="post : ${challengePosts}">
                                    <div class="card w-[190px] shadow-xl mx-8">
                                        <a th:href="@{|/usr/challenge/postdetail/${post.id}|}">
                                            <figure>
                                                <img th:src="${@photoService.getSmallPhoto(post.postPhoto)}" alt="post_image"
                                                     class="rounded-xl w-[80%] mt-8"/>
                                            </figure>
                                        </a>

                                        <div class="card-body">

                                            <a class="card-title"
                                               th:href="@{|/usr/challenge/postdetail/${post.id}|}"
                                               th:text="${#strings.length(post.postTitle) &gt; 6 ? #strings.substring(post.postTitle, 0, 6) + '...' : post.postTitle}"></a>

<!--                                            <p th:text="${#strings.length(post.postContents) &gt; 15 ? #strings.substring(post.postContents, 0, 15) + '...' : post.postContents}"></p>-->
<!--                                                <img th:if="post.challenger.equippedCharacter != null" th:src="${post.challenger.equippedCharacter.item.pattern}"/>-->
<!--                                                <img th:if="post.challenger.equippedCharacter == null" src="https://kr.object.ncloudstorage.com/devchall/devchall_img/person.png" alt="">-->
                                            <div class="flex justify-between items-center flex h-[30px]">
                                                <img class="w-10 rounded-full"
                                                     th:if="${post.challenger?.equippedCharacter?.item?.pattern}"
                                                     th:src="${post.challenger?.equippedCharacter?.item?.pattern}"/>
<!--                                                <img -->
<!--                                                     src="https://kr.object.ncloudstorage.com/devchall/devchall_img/person.png"/>-->
                                                <div>
                                                    <i class="fa-solid fa-user fa-2xl"
                                                       th:style="'color: #' + ${@rq.member.equippedFont.item.pattern}"
                                                       th:unless="${post.challenger?.equippedCharacter?.item?.pattern} "></i>
                                                </div>
                                                <span class="rounded-xl text-xs p-1 mx-1 h-auto"
                                                      th:style="'color: #' + ${@rq.member.equippedFont.item.subPattern} +
                                                                '; background: #'+${@rq.member.equippedFont.item.pattern}+' !important'"
                                                      th:text="${post.challenger.nickname}"></span>
                                            </div>
                                            <p class="flex justify-between">
                                                <span>
                                                    <i class="fa-sharp fa-solid fa-star fa-beat fa-sm" style="color: #40dd84;"></i>
                                                    <small th:text="${post.postScore}"></small>
                                                </span>
                                                <span>
                                                    <i class="fa-solid fa-message-dots"></i>
                                                    <small>2</small>
                                                </span>
                                                <span>
                                                    <i class="fa-solid fa-heart fa-bounce" style="color:firebrick"></i>
                                                    <small>3</small>
                                                </span>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <!--인증글 끝-->
                            </th:block>
                        </div>
                        <!--  페이징 시작-->
                        <div class="join pb-10"
                             th:if="${challengePosts!=null &&!challengePosts.isEmpty()}">
                            <a th:if="${challengePosts.hasPrevious}"
                               class="join-item btn btn-accent btn-sm btn-outline"
                               th:href="@{|?page=${challengePosts.number-1}|}">
                                <span><<</span>
                            </a>
                            <a th:each="page:${#numbers.sequence(0, challengePosts.totalPages-1)}"
                               th:text="${page+1}"
                               th:href="@{|?page=${page}|}"
                               th:classappend="${page == challengePosts.number} ? 'btn-active'"
                               class="join-item btn btn-accent btn-sm mx-1">1</a>
                            <a th:if="${challengePosts.hasNext}"
                               th:href="@{|?page=${challengePosts.number+1}|}"
                               class="join-item btn btn-accent btn-sm btn-outline">
                                <span>>></span>
                            </a>
                        </div>
                        <!--  페이징 끝-->
                    </div>
            </div>
        </div>
    </div>
</main>
</body>
</html>