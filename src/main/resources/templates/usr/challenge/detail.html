<html layout:decorate="~{usr/member/layout.html}" xmlns="http://www.w3.org/1999/html">

<html>
<head>
    <meta charset="UTF-8">
    <title>챌린지 디테일 페이지</title>
</head>

<body>

<main layout:fragment="main" class="flex flex-col w-full justify-center">
    <script>

        function wantJoin(challengeId) {
            if (confirm('해당 챌린지에 참여하시겠습니까?')) {
                alert("환영합니다! 챌린지에 열심히 참여해보세요!");
                location.href = "/usr/challenge/join/" + challengeId;
            } else {
                alert("참여가 취소되었습니다.");
            }
        }

    </script>


    <div class="flex justify-center items-center mt-5">
        <div>
            <img th:src="${challenge.largePhoto}" alt="challenge_image"/>
        </div>
    </div>

    <div class="flex flex-col w-full">

        <div class="flex flex-wrap">
            <div class="w-1/5"></div>
            <div class="w-3/5">
                <div class="text-black">

                    <div class="my-10">
                        <h2 class="text-[30px] bolder-double font-bold" th:text="${challenge.challengeName}"></h2>
                    </div>

                    <div class="my-7">
                        <span class="text-gray-400">챌린지 일정</span>
                        <p class="text-[20px] bolder-double"
                           th:text="${challenge.startDate} + ' 시작 =>  ' + ${challenge.challengePeriod} + '주 과정'"></p>
                    </div>

                    <div>
                        <span class="text-gray-400">챌린지 인원</span>
                        <div></div>
                        <div class="badge badge-lg badge-outline gap-3 my-5">
                            <i class="fa-solid fa-person fa-lg" style="color: #000000;"></i>
                            <p class="text-black"> -no- 명</p>
                        </div>
                    </div>

                    <div class="my-7">
                        <span class="text-gray-400">주간 인증 횟수</span>
                        <p class="text-[20px] bolder-double" th:text="'주 ' + ${challenge.challengeFrequency} + '회'"></p>
                    </div>

                    <div class="my-7">
                        <div class="badge badge-accent badge-lg gap-3 my-5">
                            <p class="text-black">챌린지 소개</p>
                        </div>
                        <div>
                            <p class="text-black" th:text="${challenge.challengeContents}"></p>
                        </div>
                    </div>

                    <div class="flex justify-end">
                        <th:block th:unless="${isJoin}">
                            <button th:onclick="'wantJoin(\'' + ${challenge.id} + '\')'"
                                    class="btn btn-accent flex justify-center">참여하기
                            </button>
                        </th:block>

                        <th:block th:if="${isJoin}">
                            <a th:href="@{|/usr/challenge/write_form/${challenge.id}|}"
                               class="btn btn-accent flex justify-center">
                                <button>챌린지 인증하기</button>
                            </a>
                        </th:block>
                    </div>
                </div>

                <div class="flex flex-col">
                    <div class="divider"></div>
                    <th:block th:unless="${hasPost}">
                        <h2 class="text-[20px] bolder-double font-bold">아직 아무도 인증하지 않았어요!</h2>
                    </th:block>

                    <div class="grid grid-cols-1 md:grid-cols-3 xl:grid-cols-4 gap-[75px]">
                        <th:block th:if="${hasPost}">
                            <!-- 인증글 내용 -->
                            <div th:each="post : ${challengePostList}">
                                <div class="card w-[200px] shadow-xl">
                                    <figure>
                                        <img th:src="${post.smallPhoto}" alt="post_image"/>
                                    </figure>
                                    <div class="card-body">
                                        <h2 class="card-title" th:text="${post.postTitle}"></h2>
                                        <p th:text="${post.postContents}"></p>
                                        <div class="card-actions justify-end">
                                            <a class="btn btn-accent"
                                               th:href="@{|/usr/challenge/postdetail/${post.id}|}">보러가기</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </th:block>
                    </div>
                </div>
                <div class="divider"></div>
                <div class="my-2" th:each="comment:${commentList}" th:unless="${#lists.isEmpty(commentList) or commentList == null}">
                    <div th:unless ="${#strings.equals(comment.challengeMember.challenger.id, @rq.member.id)}" class="chat chat-start">
                        <div class="chat-image avatar">
                            <div class="w-10 rounded-full">
                                <img src="/images/stock/photo-1534528741775-53994a69daeb.jpg" />
                            </div>
                        </div>
                        <div th:text ="${comment.challengeMember.challenger.nickname}" class="chat-header">
                            Obi-Wan Kenobi
                            <time class="text-xs opacity-50" th:text="${#temporals.format(comment.createDate, 'yy.MM.dd HH:mm')}">12:45</time>
                        </div>
                        <div class="chat-bubble" th:text="${comment.commentContent}">You were the Chosen One!</div>

                    </div>
                    <div th:if ="${#strings.equals(comment.challengeMember.challenger.id, @rq.member.id)}" class="chat chat-end">
                        <div class="chat-image avatar">
                            <div class="w-10 rounded-full">
                                <img src="/images/stock/photo-1534528741775-53994a69daeb.jpg" />
                            </div>
                        </div>
                        <div th:text ="${comment.challengeMember.challenger.nickname}" class="chat-header">
                            Anakin
                            <time class="text-xs opacity-50" th:text="${#temporals.format(comment.createDate, 'yy.MM.dd HH:mm')}" >12:46</time>
                        </div>
                        <div class="chat-bubble" th:text="${comment.commentContent}">I hate you!</div>
                    </div>
                </div>
                <form class="flex flex-row justify-center" method="post" th:action="'/usr/challenge/comment/write/'+${challenge.id}">
                    <input type="text" name ="contents" placeholder="댓글을 달아보세요!" class="my-3 mx-4 input input-bordered input-accent w-full max-w-xs" />
                    <button type="submit" class="mx-1 btn btn-accent btn-outline disabled">
                        <i class="fas fa-paper-plane" style="color: #000000"></i>
                    </button>
                </form>
            </div>

            <div class="w-1/5"></div>
        </div>
    </div>

</main>
</body>
</html>