<html layout:decorate="~{usr/member/layout.html}" xmlns="http://www.w3.org/1999/html">

<html>
<head>
    <meta charset="UTF-8">
    <title>챌린지 디테일 페이지</title>
</head>

<body class="bg-gray-100">
<main layout:fragment="main" class="flex flex-col w-full justify-center">
    <script>

        function wantJoin(challengeId) {
            if (confirm('해당 챌린지에 참여하시겠습니까?')) {
                alert("환영합니다! 챌린지에 열심히 참여해보세요!");
                location.href = "/usr/challenge/join/" + challengeId;
            } else {
                alert("참여가 취소되었습니다.");
            }
        }

    </script>


    <div class="flex w-full mt-10 mx-100 justify-center">
        <div class="mx-2 mt-9">
            <img th:src="${challenge.largePhoto}" alt="challenge_image" class="w-[85%] h-auto"/>
        </div>


        <div class="w-1/3">
            <div class="flex justify-between">
                <h3 class="text-2xl font-bold my-9" th:text="${challenge.challengeName}"></h3>
<!--                <p class="text-[30px] bolder-double font-bold mx-3" th:text="${challenge.challengeName}"></p>-->

                <th:block th:unless="${isJoin}">
                    <button th:onclick="'wantJoin(\'' + ${challenge.id} + '\')'"
                            class="btn btn-accent">참여하기
                    </button>
                </th:block>

                <th:block th:if="${isJoin}">
                    <a th:href="@{|/usr/challenge/write_form/${challenge.id}|}"
                       class="btn btn-accent mx-1 border-none mt-9" style="background-color: #03FA6E;">
                        <button>인증하기</button>
                    </a>
                </th:block>



            </div>
            <div class="card bg-white mt-3 h-75 flex place-content-around">

                <div class="flex justify-around">
                    <div class="w-30 content-center items-center">
                        <h2 class="text-[17px] font-medium mt-5">챌린지 일정</h2>
                        <h2 class="text-[17px] font-medium mt-3">챌린지 인원</h2>
                        <h2 class="text-[17px] font-medium mt-3">주간 인증 횟수</h2>
                        <h2 class="text-[17px] font-medium mt-3">챌린지 개설자</h2>
                        <h2 class="text-[17px] font-medium mt-3">챌린지 태그</h2>
                        <h2 class="text-[17px] font-medium mt-3 mb-5">총 인증 게시물 수</h2>
                    </div>

                    <div class="w-70 content-center items-center">
                        <p class="text-[17px] bolder-double mt-5"
                           th:text="${challenge.startDate} + ' ~ ' + ${challenge.endDate}"></p>
                        <div class="badge badge-lg badge-outline gap-3 mt-3">
                            <i class="fa-solid fa-person fa-lg" style="color: #000000;"></i>
                            <p class="text-black"> -no- 명</p>
                        </div>
                        <p class="text-[17px] bolder-double mt-3"
                           th:text="'주 ' + ${challenge.challengeFrequency} + '회'"></p>
                        <p class="text-[17px] bolder-double mt-3" th:text="${challenge.challengeCreator}"></p>

                        <div class="mt-3">
                            <p class="badge badge-warning text-[17px] bolder-double badge-lg"
                               th:text="${challenge.challengeLanguage}"></p>
                            <p class="badge badge-primary text-[17px] bolder-double badge-lg"
                               th:text="${challenge.challengeSubject}"></p>
                            <p class="badge badge-notice text-[17px] bolder-double badge-lg"
                               th:text="${challenge.challengePostType}"></p>
                        </div>
                        <th:block th:unless="${hasPost}">
                            <p class="text-[17px] bolder-double mt-3"> 0 개</p>
                        </th:block>
                        <th:block th:if="${hasPost}">
                            <p class="text-[17px] bolder-double mt-3 mb-5" th:text="${#lists.size(challengePostList)} + '개'"></p>
                        </th:block>

                    </div>
                </div>
            </div>
        </div>
    </div>



    <div>
        <div class="flex flex-wrap justify-center h-3/4 mt-14">
            <div class="w-1/8 h-full"></div>
            <div class="card bg-white w-5/6 h-full">
                <div class="flex flex-col h-full">
                    <h1 class="text-[20px] font-black mt-5 mx-8">Challenge Introduction</h1>
                    <p class="text-[15px] font-double mt-5 mb-5 mx-14" th:text="${challenge.challengeContents}"></p>
                </div>
            </div>
            <div class="w-1/8 h-full"></div>
        </div>


        <div class="flex flex-wrap justify-center mt-14">
            <div class="w-1/8 h-full"></div>
            <div class="card bg-white w-5/6 h-full">
                <div class="flex flex-col h-1/2">
                    <th:block th:unless="${hasPost}">
                        <h2 class="text-[20px] font-black mt-5 mx-8">아직 아무도 인증하지 않았어요!</h2>
                    </th:block>

                    <div class="grid grid-cols-1 md:grid-cols-3 xl:grid-cols-4 gap-[50px] bg-white-500 my-10">
                        <th:block th:if="${hasPost}">
                            <!-- 인증글 내용 -->
                            <div th:each="post : ${challengePostList}">
                                <div class="card w-[200px] shadow-xl mx-8">
                                    <figure>
                                        <img th:src="${post.smallPhoto}" alt="post_image"
                                             class="rounded-xl w-[80%] mt-8"/>
                                    </figure>
                                    <div class="card-body">

                                        <p>
                                            <i class="fa-sharp fa-solid fa-star fa-beat fa-sm" style="color: #40dd84;"></i>
                                            <small th:text="${post.postScore}"></small>
                                        </p>

                                        <h2 class="card-title"
                                            th:text="${#strings.length(post.postTitle) &gt; 10 ? #strings.substring(post.postTitle, 0, 10) + '...' : post.postTitle}"></h2>

                                        <p th:text="${#strings.length(post.postContents) &gt; 15 ? #strings.substring(post.postContents, 0, 15) + '...' : post.postContents}"></p>

                                        <div class="card-actions justify-end">

<!--                                            <a class="btn btn-accent mx-1 border-none text-s py-0.5 px-2" style="background-color: #03FA6E;-->
<!--                                                font-size: 13px; padding: 2px 6px;">보러가기</a>-->


                                            <div style="margin-left: auto;">
                                                <a class="btn btn-xs rounded-lg font-bold mx-1 border-none text-sm py-0.5 px-2"
                                                   style="background-color: #03FA6E;
                                                   color: #121212;
                                                   font-size: 13px; padding: 2px 6px;"
                                                   th:href="@{|/usr/challenge/postdetail/${post.id}|}">보러가기</a>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </th:block>
                    </div>
                </div>

                <div class="divider"></div>
                <div class="my-2" th:each="comment:${commentList}" th:unless="${#lists.isEmpty(commentList) or commentList == null}">
                    <div th:unless ="${#strings.equals(comment.challengeMember.challenger.id, @rq.member.id)}" class="chat chat-start">
                        <div class="chat-image avatar">
                            <div class="w-10 rounded-full">
                                <img src="/images/stock/photo-1534528741775-53994a69daeb.jpg" />
                            </div>
                        </div>

                        <div th:text ="${comment.challengeMember.challenger.nickname}" class="chat-header">
                            Obi-Wan Kenobi
                            <time class="text-xs opacity-50" th:text="${#temporals.format(comment.createDate, 'yy.MM.dd HH:mm')}">12:45</time>
                        </div>
                        <div class="chat-bubble" th:text="${comment.commentContent}">You were the Chosen One!</div>

                    </div>
                    <div th:if ="${#strings.equals(comment.challengeMember.challenger.id, @rq.member.id)}" class="chat chat-end">
                        <div class="chat-image avatar">
                            <div class="w-10 rounded-full">
                                <img src="/images/stock/photo-1534528741775-53994a69daeb.jpg" />
                            </div>
                        </div>

                        <div th:text ="${comment.challengeMember.challenger.nickname}" class="chat-header">
                            Anakin
                            <time class="text-xs opacity-50" th:text="${#temporals.format(comment.createDate, 'yy.MM.dd HH:mm')}" >12:46</time>
                        </div>
                        <div class="chat-bubble" th:text="${comment.commentContent}">I hate you!</div>
                    </div>
                </div>

                <!--데이지ui 사용한 댓글창과 버튼 수정-->
                <form class="flex flex-row justify-center" method="post" th:action="'/usr/challenge/comment/write/'+${challenge.id}">
                    <style>
                        .custom-input {
                            background-color: #ffffff;
                            border: 1px solid #03fa6e;
                            transition: border-color 0.3s;
                        }
                        .custom-input:focus {
                            outline: none;
                            border-width: 2px;
                            border-color: #03fa6e;
                        }
                    </style>
                    <input type="text" name="contents" placeholder="댓글을 달아보세요!" class="my-3 mx-4 input input-bordered input-success w-full max-w-xs custom-input" />

                    <style>
                        .custom-button {
                            background-color: #ffffff;
                            border-color: #03fa6e;
                            transition: background-color 0.3s, border-color 0.3s;
                        }
                        .custom-button:hover,
                        .custom-button:focus,
                        .custom-button:active {
                            background-color: #03fa6e;
                            border-color: #03fa6e;
                            outline: none;
                        }
                    </style>
                    <button type="submit" class="mx-1 mt-3 custom-button btn btn-outline disabled">
                        <i class="fas fa-paper-plane" style="color: #000000"></i>
                    </button>
                </form>

            </div>
            <div class="w-1/8 h-full"></div>
        </div>
    </div>
</main>
</body>
</html>